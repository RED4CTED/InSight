<!DOCTYPE html>
<html>
<head>
  <title>Screenshot Text Extractor</title>
  <link rel="stylesheet" href="popup.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- This is the only script tag we'll use - the script loader handles the rest -->
  <script src="script-loader.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <circle cx="8.5" cy="8.5" r="1.5"></circle>
          <polyline points="21 15 16 10 5 21"></polyline>
        </svg>
      </div>
      <h1>Screenshot Text Extractor</h1>
    </div>
    
    <!-- Settings tabs -->
    <div class="tabs">
      <button class="tab-button active" data-tab="capture">Capture</button>
      <button class="tab-button" data-tab="settings">Settings</button>
    </div>
    
    <!-- Tab content -->
    <div class="tab-content">
      <!-- Capture tab -->
      <div id="capture-tab" class="tab-pane active">
        <div class="capture-section">
          <button id="captureBtn" class="action-button">
            <span class="button-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
              </svg>
            </span>
            Capture Screenshot
          </button>
          
          <p class="info-text">Click to select an area of the page to capture and extract text from.</p>
        </div>
      </div>
      
      <!-- Settings tab -->
      <div id="settings-tab" class="tab-pane">
        <!-- OCR settings -->
        <div class="settings-group">
          <h2>OCR Service</h2>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="ocrService" value="local" checked> 
              Local Server
            </label>
            <label class="radio-option">
              <input type="radio" name="ocrService" value="ocrspace"> 
              OCR.space API
            </label>
            <label class="radio-option">
              <input type="radio" name="ocrService" value="custom"> 
              Custom API
            </label>
          </div>
          
          <!-- Local server settings -->
          <div id="localServerContainer">
            <h3>Local Server Settings</h3>
            <p class="info-text">Include the full URL with protocol (http:// or https://)</p>
            <div class="input-group">
              <input type="text" id="serverUrlInput" placeholder="Enter local server URL (e.g., http://localhost:8000)">
              <button id="saveServerUrlBtn" class="action-button secondary small">Save</button>
            </div>
          </div>
          
          <!-- OCR.space API settings -->
          <div id="apiKeyContainer" class="hidden">
            <h3>OCR.space API Settings</h3>
            <div class="input-group">
              <input type="password" id="apiKeyInput" placeholder="Enter OCR.space API Key">
              <button id="saveApiKeyBtn" class="action-button secondary small">Save</button>
            </div>
          </div>
          
          <!-- Custom OCR API settings -->
          <div id="customOcrContainer" class="hidden">
            <h3>Custom OCR API Settings</h3>
            <div class="input-group">
              <input type="text" id="customOcrUrlInput" placeholder="Enter API endpoint URL">
            </div>
            <h4>Request Headers</h4>
            <div class="input-group">
              <input type="text" id="customOcrHeaderKeyInput" placeholder="Header name (e.g., Authorization)">
              <input type="text" id="customOcrHeaderValueInput" placeholder="Header value">
              <button id="addOcrHeaderBtn" class="action-button secondary small">Add</button>
            </div>
            <div id="customOcrHeadersList" class="headers-list">
              <!-- Headers will be added here dynamically -->
            </div>
            <h4>Image Format</h4>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="customOcrImageFormat" value="base64" checked> 
                Base64 string
              </label>
              <label class="radio-option">
                <input type="radio" name="customOcrImageFormat" value="formData"> 
                Form Data
              </label>
            </div>
            <div class="input-group">
              <input type="text" id="customOcrParamNameInput" placeholder="Form data parameter name or JSON field name">
            </div>
            <h4>Response Format</h4>
            <div class="input-group">
              <input type="text" id="customOcrResponsePathInput" placeholder="JSON path to text (e.g., results.text)">
            </div>
            <div class="button-row">
              <button id="saveCustomOcrBtn" class="action-button secondary">Save OCR Settings</button>
              <button id="testCustomOcrBtn" class="action-button">Test</button>
            </div>
          </div>
        </div>
        
        <!-- AI API settings -->
        <div class="settings-group">
          <h2>AI Service</h2>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="aiService" value="openai" checked> 
              OpenAI API
            </label>
            <label class="radio-option">
              <input type="radio" name="aiService" value="local"> 
              Local Server
            </label>
            <label class="radio-option">
              <input type="radio" name="aiService" value="custom"> 
              Custom API
            </label>
          </div>
          
          <!-- OpenAI API settings -->
          <div id="openaiContainer">
            <h3>OpenAI API Settings</h3>
            <div class="input-group">
              <input type="password" id="openaiApiKeyInput" placeholder="Enter OpenAI API Key">
            </div>
            <h4>Model</h4>
            <div class="input-group">
              <select id="openaiModelSelect">
                <option value="gpt-4o-mini-2024-07-18">GPT-4o Mini</option>
                <option value="gpt-4o">GPT-4o</option>
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                <option value="gpt-4">GPT-4</option>
              </select>
            </div>
            <div class="button-row">
              <button id="saveOpenaiApiKeyBtn" class="action-button secondary">Save OpenAI Settings</button>
            </div>
          </div>
          
          <!-- Local AI server settings -->
          <div id="localAiServerContainer" class="hidden">
            <h3>Local AI Server Settings</h3>
            <p class="info-text">Include the full URL with protocol (http:// or https://)</p>
            <div class="input-group">
              <input type="text" id="aiServerUrlInput" placeholder="Enter local AI server URL">
            </div>
            <h4>Model</h4>
            <div class="input-group">
              <input type="text" id="localAiModelInput" placeholder="Model name (if required)">
            </div>
            <div class="button-row">
              <button id="saveAiServerUrlBtn" class="action-button secondary">Save Local AI Settings</button>
            </div>
          </div>
          
          <!-- Custom AI API settings -->
          <div id="customAiContainer" class="hidden">
            <h3>Custom AI API Settings</h3>
            <div class="input-group">
              <input type="text" id="customAiUrlInput" placeholder="Enter API endpoint URL">
            </div>
            <h4>Request Headers</h4>
            <div class="input-group">
              <input type="text" id="customAiHeaderKeyInput" placeholder="Header name (e.g., Authorization)">
              <input type="text" id="customAiHeaderValueInput" placeholder="Header value">
              <button id="addAiHeaderBtn" class="action-button secondary small">Add</button>
            </div>
            <div id="customAiHeadersList" class="headers-list">
              <!-- Headers will be added here dynamically -->
            </div>
            <h4>Request Format</h4>
            <div class="input-group">
              <input type="text" id="customAiBodyTemplateInput" placeholder='Request body template (use {{text}} as placeholder, e.g., {"prompt": "{{text}}"})'>
            </div>
            <h4>Response Format</h4>
            <div class="input-group">
              <input type="text" id="customAiResponsePathInput" placeholder="JSON path to response (e.g., choices[0].message.content)">
            </div>
            <div class="button-row">
              <button id="saveCustomAiBtn" class="action-button secondary">Save AI Settings</button>
              <button id="testCustomAiBtn" class="action-button">Test</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="loading" class="loading hidden">
      <div class="spinner"></div>
      <span>Processing...</span>
    </div>
    
    <div class="result-container">
      <h2>Extracted Text</h2>
      
      <div id="preview-container" class="preview-image-container hidden">
        <!-- Preview image will be inserted here -->
      </div>
      
      <!-- Changed from div to textarea for editing -->
      <textarea id="result" class="result-editor">No text extracted yet.</textarea>
      
      <div class="button-row">
        <button id="copyBtn" class="action-button" disabled>
          <span class="button-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </span>
          Copy
        </button>
        
        <button id="clearBtn" class="action-button secondary" disabled>
          <span class="button-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </span>
          Clear
        </button>
        
        <button id="sendToAiBtn" class="action-button" disabled>
          <span class="button-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </span>
          Send to AI
        </button>
      </div>
    </div>
    
    <!-- Response from OpenAI container -->
    <div id="ai-response-container" class="result-container hidden">
      <h2>AI Response</h2>
      <div id="ai-response" class="result"></div>
    </div>
    
    <div id="status" class="status"></div>
  </div>
</body>
</html>